// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Comercial {
  id             String     @id @default(uuid())
  nome           String
  cpf            String     @unique
  pix            String     @unique
  status         String     @default("ativo")
  senhaHash      String
  permissoes     Json
  documentoUrl   String?
  selfieUrl      String?
  createdAt      DateTime   @default(now())
  kycStatus      KycStatus  @default(PENDENTE)
  kycObservacao  String?
  kycRevisorId   String?
  kycRevisorNome String?
  kycRevisadoEm  DateTime?
  cotacoes       Cotacao[]
}

model Cliente {
  id          String    @id @default(uuid())
  nome        String
  documento   String
  email       String?
  telefone    String
  endereco    String?
  observacoes String?
  contato                 String?
  invoicePaymentTerms     String?
  invoiceDeliveryTerms    String?
  countryOfOrigin         String?
  hsCode                  String?
  deliveryInfo            String?
  shippingMethod          String?
  bankName                String?
  bankSwift               String?
  bankBranch              String?
  bankAccount             String?
  bankBeneficiary         String?
  bankBeneficiaryAddress  String?
  intermediaryBank        String?
  intermediarySwift       String?
  createdAt   DateTime  @default(now())
  cotacoes    Cotacao[]
}

model Servico {
  id          String    @id @default(uuid())
  nome        String
  tipoCusto   String
  valor       Float
  status      String    @default("ativo")
  updatedAt   DateTime  @updatedAt @default(now())
  itens       CotacaoServico[]
}

model Cotacao {
  id              String     @id @default(uuid())
  cliente         Cliente    @relation(fields: [clienteId], references: [id])
  clienteId       String
  comercial       Comercial? @relation(fields: [comercialId], references: [id])
  comercialId     String?
  valorVenda      Float
  custo           Float
  margem          Float
  comissaoPercent Float
  comissao        Float
  observacoes     String?
  status          String
  moeda           String     @default("BRL")
  cotacaoUsdtBrl  Float?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt @default(now())
  itens           CotacaoServico[]
}

model CotacaoServico {
  id              String   @id @default(uuid())
  cotacao         Cotacao  @relation(fields: [cotacaoId], references: [id], onDelete: Cascade)
  cotacaoId       String
  servico         Servico  @relation(fields: [servicoId], references: [id])
  servicoId       String
  valorVenda      Float
  custo           Float
  margem          Float
  comissaoPercent Float
  comissao        Float
  moeda           String   @default("BRL")
  ordem           Int
  createdAt       DateTime @default(now())
}

model InvoiceRecord {
  id        String   @id @default(uuid())
  number    String   @unique
  year      Int
  month     Int
  counter   Int
  payload   Json?
  createdAt DateTime @default(now())

  @@index([year, counter], map: "idx_invoice_year_counter")
}

enum KycStatus {
  PENDENTE
  APROVADO
  REPROVADO
}
