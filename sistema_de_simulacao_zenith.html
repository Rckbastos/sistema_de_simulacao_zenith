<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenith Pay - Sistema de Cota√ß√£o v4.0</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-card: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #999999;
            --accent-gold: #D4AF37;
            --accent-gold-dark: #B8941F;
            --border-color: #333333;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #f44336;
            --info: #2196F3;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-box {
            background: var(--bg-card);
            border: 2px solid var(--accent-gold);
            border-radius: 12px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
        }
        
        .login-logo {
            font-size: 36px;
            font-weight: 700;
            color: var(--accent-gold);
            text-align: center;
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }
        
        .app-container {
            display: none;
            padding: 20px;
        }
        
        .app-container.active { display: block; }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-gold);
            border-radius: 12px;
            padding: 25px 30px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 32px;
            font-weight: 700;
            color: var(--accent-gold);
        }
        
        .header-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        .user-info { text-align: right; }
        
        .user-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .user-role {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .btn-logout {
            margin-top: 8px;
            padding: 6px 15px;
            background: var(--danger);
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--border-color);
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab:hover { color: var(--accent-gold); }
        .tab.active {
            color: var(--accent-gold);
            border-bottom-color: var(--accent-gold);
        }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--accent-gold);
        }
        
        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--accent-gold);
            margin-bottom: 8px;
        }
        
        .stat-detail {
            font-size: 13px;
            color: var(--success);
        }
        
        .form-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--accent-gold);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .form-group { margin-bottom: 25px; }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 15px;
            transition: all 0.3s;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }
        
        .input-group { position: relative; }
        
        .input-prefix {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 15px;
        }
        
        .input-with-prefix { padding-left: 40px; }
        
        .input-suffix {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 15px;
        }
        
        .input-with-suffix { padding-right: 40px; }
        
        .btn {
            padding: 12px 25px;
            border-radius: 8px;
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--accent-gold);
            color: #000;
        }
        
        .btn-primary:hover {
            background: var(--accent-gold-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
        }
        
        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover { background: var(--bg-card); }
        
        .btn-success {
            background: var(--success);
            color: #fff;
        }
        
        .btn-warning {
            background: var(--warning);
            color: #fff;
        }
        
        .btn-info {
            background: var(--info);
            color: #fff;
        }
        
        .btn-block {
            width: 100%;
            justify-content: center;
        }

        .permission-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            background: rgba(255, 255, 255, 0.02);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .permission-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--text-primary);
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .table-container {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table thead { background: var(--bg-secondary); }
        
        .table th {
            padding: 15px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: var(--accent-gold);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .table td {
            padding: 15px;
            font-size: 14px;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
        }
        
        .table tbody tr:hover { background: var(--bg-secondary); }
        
        .badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-success {
            background: rgba(76, 175, 80, 0.2);
            color: var(--success);
        }
        
        .badge-warning {
            background: rgba(255, 152, 0, 0.2);
            color: var(--warning);
        }
        
        .badge-info {
            background: rgba(33, 150, 243, 0.2);
            color: var(--info);
        }
        
        .badge-danger {
            background: rgba(244, 67, 54, 0.2);
            color: var(--danger);
        }
        
        .action-btn {
            padding: 6px 12px;
            border-radius: 6px;
            border: none;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            margin-right: 5px;
        }
        
        .action-btn-edit {
            background: var(--info);
            color: #fff;
        }
        
        .action-btn-delete {
            background: var(--danger);
            color: #fff;
        }
        
        .action-btn-view {
            background: var(--accent-gold);
            color: #000;
        }
        
        .file-upload {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload:hover {
            border-color: var(--accent-gold);
            background: var(--bg-secondary);
        }
        
        .file-upload input[type="file"] { display: none; }
        
        .file-preview {
            margin-top: 10px;
            max-width: 200px;
            border-radius: 8px;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }
        
        .filter-bar {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-bar .form-input,
        .filter-bar .form-select {
            flex: 1;
            min-width: 200px;
            margin-bottom: 0;
        }
        
        @media (max-width: 768px) {
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .tabs {
                overflow-x: auto;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .filter-bar {
                flex-direction: column;
            }
            
            .filter-bar .form-input,
            .filter-bar .form-select {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <div class="login-logo"><img src="zenith-logo.png" alt="Zenith" style="height: 60px; display: block; margin: 0 auto 15px;"></div>
            <div class="login-subtitle">Sistema de Cota√ß√£o Comercial v4.0</div>
            
            <div class="form-group">
                <label class="form-label">Usu√°rio</label>
                <input type="text" class="form-input" id="loginUser" placeholder="Digite seu usu√°rio">
            </div>
            
            <div class="form-group">
                <label class="form-label">Senha</label>
                <input type="password" class="form-input" id="loginPass" placeholder="Digite sua senha">
            </div>
            
            <button class="btn btn-primary btn-block" onclick="fazerLogin()">üîê Entrar</button>
            
            <div style="margin-top: 20px; text-align: center; font-size: 12px; color: var(--text-secondary);">
                Comerciais: informe seu <strong>CPF ou chave PIX</strong> com a senha definida.
            </div>
        </div>
    </div>
    
    <!-- Main App -->
    <div id="appContainer" class="app-container">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div>
                    <div class="logo"><img src="zenith-logo.png" alt="Zenith" style="height: 50px;"></div>
                    <div class="header-subtitle">Sistema de Cota√ß√£o Comercial v4.0</div>
                </div>
                <div class="user-info">
                    <div class="user-name" id="userName">Admin</div>
                    <div class="user-role" id="userRole">Administrador</div>
                    <button class="btn-logout" onclick="fazerLogout()">üö™ Sair</button>
                </div>
            </div>
            
            <!-- Tabs -->
            <div class="tabs" id="tabsContainer">
                <button class="tab active" data-tab="dashboard" data-admin-only="true" onclick="switchTab('dashboard', this)">üìä Dashboard</button>
                <button class="tab" data-tab="nova-cotacao" onclick="switchTab('nova-cotacao', this)">‚ûï Nova Cota√ß√£o</button>
                <button class="tab" data-tab="cotacoes-abertas" onclick="switchTab('cotacoes-abertas', this)">üìã Cota√ß√µes em Aberto</button>
                <button class="tab" data-tab="cotacoes-fechadas" onclick="switchTab('cotacoes-fechadas', this)">‚úÖ Cota√ß√µes Fechadas</button>
                <button class="tab" data-tab="clientes" onclick="switchTab('clientes', this)">üë• Clientes</button>
                <button class="tab admin-only" data-tab="comerciais" data-admin-only="true" onclick="switchTab('comerciais', this)">ü§ù Comerciais</button>
                <button class="tab admin-only" data-tab="admin" data-admin-only="true" onclick="switchTab('admin', this)">‚öôÔ∏è Admin - Servi√ßos</button>
            </div>
            
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Cota√ß√µes em Aberto</div>
                        <div class="stat-value" id="totalAberto">0</div>
                        <div class="stat-detail">Em an√°lise + Aguardando</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Cota√ß√µes Fechadas</div>
                        <div class="stat-value" id="totalFechado">0</div>
                        <div class="stat-detail">Este m√™s</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Valor Total</div>
                        <div class="stat-value" id="valorTotal">R$ 0</div>
                        <div class="stat-detail">Cota√ß√µes fechadas</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Clientes Ativos</div>
                        <div class="stat-value" id="totalClientes">0</div>
                        <div class="stat-detail">Cadastrados</div>
                    </div>
                </div>
            </div>
            
            <!-- Nova Cota√ß√£o Tab -->
            <div id="nova-cotacao" class="tab-content">
                <div class="grid-2">
                    <div class="form-section">
                        <h2 class="section-title">üìù Dados da Cota√ß√£o</h2>
                        
                        <div class="form-group">
                            <label class="form-label">Cliente *</label>
                            <select class="form-select" id="cotacaoCliente">
                                <option value="">Selecione um cliente</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Servi√ßo *</label>
                            <select class="form-select" id="cotacaoServico" onchange="calcularCotacao()">
                                <option value="">Selecione um servi√ßo</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Custo do Servi√ßo</label>
                            <input type="text" class="form-input" id="custoDisplay" readonly placeholder="Selecione um servi√ßo">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Valor de Venda *</label>
                            <div class="input-group">
                                <span class="input-prefix">R$</span>
                                <input type="number" class="form-input input-with-prefix" id="valorVenda" placeholder="0,00" oninput="calcularCotacao()">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Comiss√£o (%)</label>
                            <div class="input-group">
                                <input type="number" class="form-input input-with-suffix" id="comissao" placeholder="0" min="0" max="100" oninput="calcularCotacao()">
                                <span class="input-suffix">%</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Observa√ß√µes</label>
                            <textarea class="form-textarea" id="observacoes" placeholder="Observa√ß√µes adicionais (opcional)"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-section" style="background: linear-gradient(135deg, var(--bg-secondary) 0%, #1a1a1a 100%); border: 2px solid var(--accent-gold);">
                        <h2 class="section-title">üí∞ Resumo da Cota√ß√£o</h2>
                        
                        <div style="padding: 15px 0; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary);">Custo do Servi√ßo:</span>
                            <span style="font-weight: 700;" id="resultCusto">R$ 0,00</span>
                        </div>
                        
                        <div style="padding: 15px 0; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary);">Valor de Venda:</span>
                            <span style="font-weight: 700;" id="resultVenda">R$ 0,00</span>
                        </div>
                        
                        <div style="padding: 15px 0; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary);">Margem de Lucro:</span>
                            <span style="font-weight: 700; color: var(--success);" id="resultMargem">R$ 0,00</span>
                        </div>
                        
                        <div style="padding: 15px 0; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary);">Comiss√£o (%):</span>
                            <span style="font-weight: 700;" id="resultComissaoPercent">0%</span>
                        </div>
                        
                        <div style="padding: 15px 0; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary);">Sua Comiss√£o:</span>
                            <span style="font-weight: 700; color: var(--success);" id="resultComissao">R$ 0,00</span>
                        </div>
                        
                        <div style="padding: 20px 0; border-top: 2px solid var(--accent-gold); margin-top: 15px; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 18px; font-weight: 600; color: var(--accent-gold);">Valor para o Cliente:</span>
                            <span style="font-size: 32px; font-weight: 700; color: var(--accent-gold);" id="resultFinal">R$ 0,00</span>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn btn-success" onclick="salvarCotacao('fechada')">‚úì Fechar Cota√ß√£o</button>
                            <button class="btn btn-warning" onclick="salvarCotacao('analise')">üîç Em An√°lise</button>
                            <button class="btn btn-info" onclick="salvarCotacao('aguardando')">‚è≥ Aguardando Confirma√ß√£o</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Cota√ß√µes em Aberto Tab -->
            <div id="cotacoes-abertas" class="tab-content">
                <div class="section-title">üìã Cota√ß√µes em Aberto</div>
                
                <div class="filter-bar">
                    <input type="text" class="form-input" id="filtroAbertoBusca" placeholder="Buscar por cliente..." onkeyup="filtrarCotacoesAbertas()">
                    <select class="form-select" id="filtroAbertoStatus" onchange="filtrarCotacoesAbertas()">
                        <option value="">Todos os status</option>
                        <option value="analise">Em An√°lise</option>
                        <option value="aguardando">Aguardando Confirma√ß√£o</option>
                    </select>
                </div>
                
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Cliente</th>
                                <th>Servi√ßo</th>
                                <th>Valor</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaCotacoesAbertas">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                    Nenhuma cota√ß√£o em aberto
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Cota√ß√µes Fechadas Tab -->
            <div id="cotacoes-fechadas" class="tab-content">
                <div class="section-title">‚úÖ Cota√ß√µes Fechadas</div>
                
                <div class="filter-bar">
                    <input type="text" class="form-input" id="filtroFechadoBusca" placeholder="Buscar por cliente..." onkeyup="filtrarCotacoesFechadas()">
                    <select class="form-select" id="filtroFechadoPeriodo" onchange="filtrarCotacoesFechadas()">
                        <option value="">Todos os per√≠odos</option>
                        <option value="hoje">Hoje</option>
                        <option value="semana">Esta semana</option>
                        <option value="mes">Este m√™s</option>
                    </select>
                </div>
                
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Cliente</th>
                                <th>Servi√ßo</th>
                                <th>Valor</th>
                                <th>Comiss√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaCotacoesFechadas">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                    Nenhuma cota√ß√£o fechada
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Clientes Tab -->
            <div id="clientes" class="tab-content">
                <div class="section-title">üë• Gerenciar Clientes</div>
                
                <div class="table-container" style="margin-bottom: 30px;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nome/Empresa</th>
                                <th>CPF/CNPJ</th>
                                <th>Contato</th>
                                <th>Total Movimentado</th>
                                <th>Cota√ß√µes</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaClientes">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                    Nenhum cliente cadastrado
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">‚ûï Cadastrar Novo Cliente</h3>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">Nome/Raz√£o Social *</label>
                            <input type="text" class="form-input" id="clienteNome" placeholder="Nome completo ou raz√£o social">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">CPF/CNPJ *</label>
                            <input type="text" class="form-input" id="clienteDoc" placeholder="000.000.000-00 ou 00.000.000/0000-00">
                        </div>
                    </div>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">E-mail</label>
                            <input type="email" class="form-input" id="clienteEmail" placeholder="email@exemplo.com">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Telefone/WhatsApp *</label>
                            <input type="text" class="form-input" id="clienteTelefone" placeholder="(00) 00000-0000">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Endere√ßo Completo</label>
                        <input type="text" class="form-input" id="clienteEndereco" placeholder="Rua, n√∫mero, bairro, cidade - UF">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Observa√ß√µes</label>
                        <textarea class="form-textarea" id="clienteObs" placeholder="Informa√ß√µes adicionais sobre o cliente"></textarea>
                    </div>
                    
                    <button class="btn btn-primary" onclick="salvarCliente()">üíæ Salvar Cliente</button>
                    <button class="btn btn-secondary" style="margin-left: 10px;" onclick="limparFormCliente()">üîÑ Limpar</button>
                </div>
            </div>
            
            <!-- Comerciais Tab -->
            <div id="comerciais" class="tab-content">
                <div class="section-title">ü§ù Gerenciar Comerciais</div>
                
                <div class="table-container" style="margin-bottom: 30px;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>CPF</th>
                                <th>Chave PIX</th>
                                <th>Permiss√µes</th>
                                <th>Status</th>
                                <th>Data Cadastro</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaComerciais">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                    Nenhum comercial cadastrado
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">‚ûï Cadastrar Novo Comercial</h3>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">Nome Completo *</label>
                            <input type="text" class="form-input" id="comercialNome" placeholder="Nome completo">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">CPF *</label>
                            <input type="text" class="form-input" id="comercialCPF" placeholder="000.000.000-00" maxlength="14">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Chave PIX *</label>
                        <input type="text" class="form-input" id="comercialPix" placeholder="CPF, e-mail, telefone ou chave aleat√≥ria">
                    </div>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">Documento (RG/CNH) *</label>
                            <div class="file-upload" onclick="document.getElementById('comercialDoc').click()">
                                <input type="file" id="comercialDoc" accept="image/*" onchange="previewImage(this, 'previewDoc')">
                                <div>üìÑ Clique para anexar documento</div>
                                <img id="previewDoc" class="file-preview" style="display: none;">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Selfie *</label>
                            <div class="file-upload" onclick="document.getElementById('comercialSelfie').click()">
                                <input type="file" id="comercialSelfie" accept="image/*" onchange="previewImage(this, 'previewSelfie')">
                                <div>ü§≥ Clique para anexar selfie</div>
                                <img id="previewSelfie" class="file-preview" style="display: none;">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="comercialStatus">
                            <option value="ativo">Ativo</option>
                            <option value="inativo">Inativo</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Senha do Comercial *</label>
                        <input type="password" class="form-input" id="comercialSenha" placeholder="Defina uma senha segura">
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 6px;">
                            Deixe em branco ao editar para manter a senha atual.
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Permiss√µes de Acesso *</label>
                        <div class="permission-list">
                            <label class="permission-item">
                                <input type="checkbox" id="permDashboard">
                                Dashboard
                            </label>
                            <label class="permission-item">
                                <input type="checkbox" id="permNovaCotacao" checked>
                                Nova Cota√ß√£o
                            </label>
                            <label class="permission-item">
                                <input type="checkbox" id="permCotacoesAbertas" checked>
                                Cota√ß√µes em Aberto
                            </label>
                            <label class="permission-item">
                                <input type="checkbox" id="permCotacoesFechadas" checked>
                                Cota√ß√µes Fechadas
                            </label>
                            <label class="permission-item">
                                <input type="checkbox" id="permClientes" checked>
                                Clientes
                            </label>
                            <label class="permission-item">
                                <input type="checkbox" id="permComerciais">
                                Gerenciar Comerciais
                            </label>
                            <label class="permission-item">
                                <input type="checkbox" id="permAdminServicos">
                                Admin - Servi√ßos
                            </label>
                            <label class="permission-item">
                                <input type="checkbox" id="permAdminMaster">
                                Administrador (todos os acessos)
                            </label>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="salvarComercial()">üíæ Salvar Comercial</button>
                    <button class="btn btn-secondary" style="margin-left: 10px;" onclick="limparFormComercial()">üîÑ Limpar</button>
                </div>
            </div>
            
            <!-- Admin Servi√ßos Tab -->
            <div id="admin" class="tab-content">
                <div class="section-title">‚öôÔ∏è Gerenciar Servi√ßos e Custos</div>
                
                <div class="table-container" style="margin-bottom: 30px;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Servi√ßo</th>
                                <th>Tipo de Custo</th>
                                <th>Valor do Custo</th>
                                <th>Status</th>
                                <th>√öltima Atualiza√ß√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaServicos"></tbody>
                    </table>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">‚ûï Adicionar/Editar Servi√ßo</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Nome do Servi√ßo</label>
                        <input type="text" class="form-input" id="adminNomeServico" placeholder="Ex: Convers√£o de Pix para Usdt">
                    </div>
                    
                    <div class="grid-3">
                        <div class="form-group" style="margin: 0;">
                            <label class="form-label">Tipo de Custo</label>
                            <select class="form-select" id="adminTipoCusto">
                                <option value="fixo">Valor Fixo (R$)</option>
                                <option value="percentual">Percentual (%)</option>
                            </select>
                        </div>
                        
                        <div class="form-group" style="margin: 0;">
                            <label class="form-label">Valor do Custo</label>
                            <input type="number" class="form-input" id="adminCustoServico" placeholder="0" step="0.01">
                        </div>
                        
                        <div class="form-group" style="margin: 0;">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="adminStatusServico">
                                <option value="ativo">Ativo</option>
                                <option value="inativo">Inativo</option>
                            </select>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="salvarServico()">üíæ Salvar Servi√ßo</button>
                    <button class="btn btn-secondary" style="margin-left: 10px;" onclick="limparFormAdmin()">üîÑ Limpar</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Dados globais
        const STORAGE_KEYS = {
            servicos: 'zenith-servicos',
            clientes: 'zenith-clientes',
            comerciais: 'zenith-comerciais',
            cotacoes: 'zenith-cotacoes'
        };
        const STORAGE_ENABLED = typeof Storage !== 'undefined';
        const ADMIN_CREDENTIALS = { username: 'admin', password: 'admin123' };
        const PERMISSOES_LABELS = {
            dashboard: 'Dashboard',
            novaCotacao: 'Nova Cota√ß√£o',
            cotacoesAbertas: 'Cota√ß√µes em Aberto',
            cotacoesFechadas: 'Cota√ß√µes Fechadas',
            clientes: 'Clientes',
            comerciais: 'Gerenciar Comerciais',
            adminServicos: 'Admin - Servi√ßos',
            adminMaster: 'Administrador (todos os acessos)'
        };
        const TAB_PERMISSION_MAP = {
            'dashboard': 'dashboard',
            'nova-cotacao': 'novaCotacao',
            'cotacoes-abertas': 'cotacoesAbertas',
            'cotacoes-fechadas': 'cotacoesFechadas',
            'clientes': 'clientes',
            'comerciais': 'comerciais',
            'admin': 'adminServicos'
        };

        let usuarioLogado = null;

        const defaultServicos = [
            { id: 1, nome: 'Convers√£o de Pix para Usdt', tipoCusto: 'percentual', custo: 3, status: 'ativo', dataAtualizacao: '04/12/2025' },
            { id: 2, nome: 'Convers√£o Usdt para Pix', tipoCusto: 'percentual', custo: 3, status: 'ativo', dataAtualizacao: '04/12/2025' },
            { id: 3, nome: 'Bancarizar Ch√£o para Pix', tipoCusto: 'fixo', custo: 0, status: 'ativo', dataAtualizacao: '04/12/2025' },
            { id: 4, nome: 'Bancarizar Ch√£o para Usdt', tipoCusto: 'fixo', custo: 0, status: 'ativo', dataAtualizacao: '04/12/2025' },
            { id: 5, nome: 'Pix para Ch√£o', tipoCusto: 'fixo', custo: 0, status: 'ativo', dataAtualizacao: '04/12/2025' },
            { id: 6, nome: 'Remessas Internacionais', tipoCusto: 'fixo', custo: 0, status: 'ativo', dataAtualizacao: '04/12/2025' }
        ];
        const defaultClientes = [];
        const defaultComerciais = [];
        const defaultCotacoes = [];

        let servicos = loadFromStorage(STORAGE_KEYS.servicos, defaultServicos);
        let clientes = loadFromStorage(STORAGE_KEYS.clientes, defaultClientes);
        let comerciais = loadFromStorage(STORAGE_KEYS.comerciais, defaultComerciais);
        let cotacoes = loadFromStorage(STORAGE_KEYS.cotacoes, defaultCotacoes);
        let servicoEditando = null;
        let comercialEditando = null;
        let clienteEditando = null;

        function isAdminUser() {
            return usuarioLogado?.tipo === 'admin' || usuarioLogado?.permissoes?.adminMaster;
        }

        function getComercialIdAtual() {
            return usuarioLogado?.tipo === 'comercial' ? usuarioLogado.id : null;
        }

        function getDefaultPermissoes() {
            return {
                dashboard: true,
                novaCotacao: true,
                cotacoesAbertas: true,
                cotacoesFechadas: true,
                clientes: true,
                comerciais: false,
                adminServicos: false,
                adminMaster: false
            };
        }

        function cloneData(data) {
            return JSON.parse(JSON.stringify(data));
        }

        function loadFromStorage(key, fallback) {
            if (!STORAGE_ENABLED) {
                return cloneData(fallback);
            }
            try {
                const stored = localStorage.getItem(key);
                if (stored) {
                    return JSON.parse(stored);
                }
            } catch (error) {
                console.warn('Falha ao carregar dados salvos', error);
            }
            return cloneData(fallback);
        }

        function persistState() {
            if (!STORAGE_ENABLED) {
                return;
            }
            try {
                localStorage.setItem(STORAGE_KEYS.servicos, JSON.stringify(servicos));
                localStorage.setItem(STORAGE_KEYS.clientes, JSON.stringify(clientes));
                localStorage.setItem(STORAGE_KEYS.comerciais, JSON.stringify(comerciais));
                localStorage.setItem(STORAGE_KEYS.cotacoes, JSON.stringify(cotacoes));
            } catch (error) {
                console.warn('Falha ao salvar dados', error);
            }
        }

        function normalizarPermissoes(permissoes) {
            const base = getDefaultPermissoes();
            Object.keys(base).forEach(key => {
                base[key] = typeof permissoes?.[key] === 'boolean' ? permissoes[key] : base[key];
            });
            return base;
        }

        function getPermissoesFromForm() {
            return {
                dashboard: document.getElementById('permDashboard').checked,
                novaCotacao: document.getElementById('permNovaCotacao').checked,
                cotacoesAbertas: document.getElementById('permCotacoesAbertas').checked,
                cotacoesFechadas: document.getElementById('permCotacoesFechadas').checked,
                clientes: document.getElementById('permClientes').checked,
                comerciais: document.getElementById('permComerciais').checked,
                adminServicos: document.getElementById('permAdminServicos').checked,
                adminMaster: document.getElementById('permAdminMaster').checked
            };
        }

        function preencherPermissoesForm(permissoes) {
            const dados = normalizarPermissoes(permissoes);
            document.getElementById('permDashboard').checked = dados.dashboard;
            document.getElementById('permNovaCotacao').checked = dados.novaCotacao;
            document.getElementById('permCotacoesAbertas').checked = dados.cotacoesAbertas;
            document.getElementById('permCotacoesFechadas').checked = dados.cotacoesFechadas;
            document.getElementById('permClientes').checked = dados.clientes;
            document.getElementById('permComerciais').checked = dados.comerciais;
            document.getElementById('permAdminServicos').checked = dados.adminServicos;
            document.getElementById('permAdminMaster').checked = dados.adminMaster;
        }

        function definirPermissoesPadraoForm() {
            preencherPermissoesForm(getDefaultPermissoes());
        }

        function podeAcessarTab(tabName) {
            if (!usuarioLogado) return false;
            if (isAdminUser()) return true;
            const permKey = TAB_PERMISSION_MAP[tabName];
            if (!permKey) return false;
            return Boolean(usuarioLogado.permissoes?.[permKey]);
        }

        function getCotacoesVisiveis() {
            if (isAdminUser()) return cotacoes;
            const atualId = getComercialIdAtual();
            if (!atualId) return [];
            return cotacoes.filter(c => c.comercialId === atualId);
        }

        function podeGerenciarCotacao(cotacao) {
            if (!cotacao) return false;
            return isAdminUser() || (cotacao.comercialId && cotacao.comercialId === getComercialIdAtual());
        }

        function aplicarPermissoesNasTabs() {
            const isAdmin = isAdminUser();
            document.querySelectorAll('.tab').forEach(btn => {
                const tabName = btn.getAttribute('data-tab');
                if (!tabName) return;
                if (isAdmin) {
                    btn.style.display = '';
                    return;
                }
                const permKey = TAB_PERMISSION_MAP[tabName];
                btn.style.display = permKey && usuarioLogado?.permissoes?.[permKey] ? '' : 'none';
            });
        }

        function obterPrimeiraAbaPermitida() {
            if (isAdminUser()) {
                return 'dashboard';
            }
            const ordem = ['dashboard','nova-cotacao', 'cotacoes-abertas', 'cotacoes-fechadas', 'clientes', 'comerciais', 'admin'];
            for (const tab of ordem) {
                if (podeAcessarTab(tab)) {
                    return tab;
                }
            }
            return null;
        }
        
        // Login
        function fazerLogin() {
            const user = document.getElementById('loginUser').value.trim();
            const pass = document.getElementById('loginPass').value;
            
            if (user === ADMIN_CREDENTIALS.username && pass === ADMIN_CREDENTIALS.password) {
                usuarioLogado = { nome: 'Administrador', tipo: 'admin', id: 'admin' };
            } else {
                const comercial = comerciais.find(c => (c.cpf === user || c.pix === user) && c.senha === pass);
                if (comercial) {
                    usuarioLogado = { 
                        id: comercial.id,
                        nome: comercial.nome, 
                        tipo: 'comercial',
                        permissoes: normalizarPermissoes(comercial.permissoes)
                    };
                } else {
                    alert('‚ùå Usu√°rio ou senha incorretos!');
                    return;
                }
            }
            
            document.getElementById('userName').textContent = usuarioLogado.nome;
            document.getElementById('userRole').textContent = isAdminUser() ? 'Administrador' : 'Comercial';
            
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContainer').classList.add('active');
            carregarDados();
            aplicarPermissoesNasTabs();
            const abaInicial = obterPrimeiraAbaPermitida();
            if (abaInicial) {
                switchTab(abaInicial);
            } else {
                alert('Nenhuma permiss√£o atribu√≠da a este comercial. Contate um administrador.');
            }
        }
        
        function fazerLogout() {
            if (confirm('Deseja realmente sair?')) {
                usuarioLogado = null;
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('appContainer').classList.remove('active');
                document.getElementById('loginUser').value = '';
                document.getElementById('loginPass').value = '';
            }
        }
        
        // Switch Tabs
        function switchTab(tabName, triggerEl) {
            if (!podeAcessarTab(tabName)) {
                alert('Voc√™ n√£o possui permiss√£o para acessar esta √°rea.');
                return;
            }
            
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (triggerEl) {
                triggerEl.classList.add('active');
            } else {
                const tabButton = document.querySelector(`.tab[data-tab="${tabName}"]`);
                if (tabButton) tabButton.classList.add('active');
            }
            
            const section = document.getElementById(tabName);
            if (section) {
                section.classList.add('active');
            }
        }
        
        // Carregar todos os dados
        function carregarDados() {
            carregarServicos();
            carregarClientes();
            carregarComerciais();
            carregarCotacoes();
            atualizarDashboard();
        }

        definirPermissoesPadraoForm();
        
        // Servi√ßos
        function carregarServicos() {
            const selectServico = document.getElementById('cotacaoServico');
            selectServico.innerHTML = '<option value="">Selecione um servi√ßo</option>';
            
            servicos.filter(s => s.status === 'ativo').forEach(servico => {
                const option = document.createElement('option');
                option.value = servico.id;
                const custoDisplay = servico.tipoCusto === 'percentual' 
                    ? `${servico.custo}%` 
                    : `R$ ${servico.custo.toFixed(2)}`;
                option.textContent = `${servico.nome} - Custo: ${custoDisplay}`;
                selectServico.appendChild(option);
            });
            
            const tabelaServicos = document.getElementById('tabelaServicos');
            tabelaServicos.innerHTML = '';
            
            servicos.forEach(servico => {
                const tr = document.createElement('tr');
                const custoDisplay = servico.tipoCusto === 'percentual' 
                    ? `${servico.custo}%` 
                    : `R$ ${servico.custo.toFixed(2)}`;
                const tipoDisplay = servico.tipoCusto === 'percentual' ? 'Percentual (%)' : 'Valor Fixo (R$)';
                
                tr.innerHTML = `
                    <td><strong>${servico.nome}</strong></td>
                    <td><span class="badge badge-info">${tipoDisplay}</span></td>
                    <td>${custoDisplay}</td>
                    <td><span class="badge badge-${servico.status === 'ativo' ? 'success' : 'warning'}">${servico.status.toUpperCase()}</span></td>
                    <td>${servico.dataAtualizacao}</td>
                    <td>
                        <button class="action-btn action-btn-edit" onclick="editarServico(${servico.id})">‚úèÔ∏è Editar</button>
                        <button class="action-btn action-btn-delete" onclick="excluirServico(${servico.id})">üóëÔ∏è Excluir</button>
                    </td>
                `;
                tabelaServicos.appendChild(tr);
            });
        }
        
        function editarServico(id) {
            const servico = servicos.find(s => s.id === id);
            if (servico) {
                servicoEditando = id;
                document.getElementById('adminNomeServico').value = servico.nome;
                document.getElementById('adminTipoCusto').value = servico.tipoCusto;
                document.getElementById('adminCustoServico').value = servico.custo;
                document.getElementById('adminStatusServico').value = servico.status;
            }
        }
        
        function salvarServico() {
            const nome = document.getElementById('adminNomeServico').value;
            const tipoCusto = document.getElementById('adminTipoCusto').value;
            const custo = parseFloat(document.getElementById('adminCustoServico').value) || 0;
            const status = document.getElementById('adminStatusServico').value;
            
            if (!nome) {
                alert('Por favor, informe o nome do servi√ßo!');
                return;
            }
            
            const hoje = new Date().toLocaleDateString('pt-BR');
            
            if (servicoEditando) {
                const servico = servicos.find(s => s.id === servicoEditando);
                if (servico) {
                    servico.nome = nome;
                    servico.tipoCusto = tipoCusto;
                    servico.custo = custo;
                    servico.status = status;
                    servico.dataAtualizacao = hoje;
                }
                servicoEditando = null;
            } else {
                const novoId = Math.max(...servicos.map(s => s.id)) + 1;
                servicos.push({ id: novoId, nome, tipoCusto, custo, status, dataAtualizacao: hoje });
            }
            
            persistState();
            carregarServicos();
            limparFormAdmin();
            alert('‚úì Servi√ßo salvo com sucesso!');
        }
        
        function excluirServico(id) {
            if (confirm('Tem certeza que deseja excluir este servi√ßo?')) {
                servicos = servicos.filter(s => s.id !== id);
                persistState();
                carregarServicos();
                alert('‚úì Servi√ßo exclu√≠do com sucesso!');
            }
        }
        
        function limparFormAdmin() {
            document.getElementById('adminNomeServico').value = '';
            document.getElementById('adminTipoCusto').value = 'fixo';
            document.getElementById('adminCustoServico').value = '';
            document.getElementById('adminStatusServico').value = 'ativo';
            servicoEditando = null;
        }
        
        // Clientes
        function carregarClientes() {
            const selectCliente = document.getElementById('cotacaoCliente');
            selectCliente.innerHTML = '<option value="">Selecione um cliente</option>';
            
            clientes.forEach(cliente => {
                const option = document.createElement('option');
                option.value = cliente.id;
                option.textContent = cliente.nome;
                selectCliente.appendChild(option);
            });
            
            const tabela = document.getElementById('tabelaClientes');
            const cotacoesVisiveis = getCotacoesVisiveis();
            
            if (clientes.length === 0) {
                tabela.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhum cliente cadastrado</td></tr>';
            } else {
                tabela.innerHTML = '';
                clientes.forEach(cliente => {
                    const totalMovimentado = calcularTotalMovimentado(cliente.id, cotacoesVisiveis);
                    const numCotacoes = cotacoesVisiveis.filter(c => c.clienteId === cliente.id).length;
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><strong>${cliente.nome}</strong></td>
                        <td>${cliente.documento}</td>
                        <td>${cliente.telefone}</td>
                        <td style="color: var(--accent-gold); font-weight: 700;">R$ ${totalMovimentado.toFixed(2)}</td>
                        <td>${numCotacoes}</td>
                        <td>
                            <button class="action-btn action-btn-view" onclick="verHistoricoCliente(${cliente.id})">üëÅÔ∏è Hist√≥rico</button>
                            <button class="action-btn action-btn-edit" onclick="editarCliente(${cliente.id})">‚úèÔ∏è Editar</button>
                            <button class="action-btn action-btn-delete" onclick="excluirCliente(${cliente.id})">üóëÔ∏è Excluir</button>
                        </td>
                    `;
                    tabela.appendChild(tr);
                });
            }
        }
        
        function calcularTotalMovimentado(clienteId, cotacoesLista) {
            const base = cotacoesLista || getCotacoesVisiveis();
            return base
                .filter(c => c.clienteId === clienteId && c.status === 'fechada')
                .reduce((total, c) => total + c.valorVenda, 0);
        }
        
        function salvarCliente() {
            const nome = document.getElementById('clienteNome').value;
            const documento = document.getElementById('clienteDoc').value;
            const email = document.getElementById('clienteEmail').value;
            const telefone = document.getElementById('clienteTelefone').value;
            const endereco = document.getElementById('clienteEndereco').value;
            const obs = document.getElementById('clienteObs').value;
            
            if (!nome || !documento || !telefone) {
                alert('Por favor, preencha os campos obrigat√≥rios!');
                return;
            }
            
            const hoje = new Date().toLocaleDateString('pt-BR');
            
            if (clienteEditando) {
                const cliente = clientes.find(c => c.id === clienteEditando);
                if (cliente) {
                    cliente.nome = nome;
                    cliente.documento = documento;
                    cliente.email = email;
                    cliente.telefone = telefone;
                    cliente.endereco = endereco;
                    cliente.obs = obs;
                }
                clienteEditando = null;
            } else {
                const novoId = clientes.length > 0 ? Math.max(...clientes.map(c => c.id)) + 1 : 1;
                clientes.push({
                    id: novoId,
                    nome,
                    documento,
                    email,
                    telefone,
                    endereco,
                    obs,
                    dataCadastro: hoje
                });
            }
            
            persistState();
            carregarClientes();
            limparFormCliente();
            atualizarDashboard();
            alert('‚úì Cliente salvo com sucesso!');
        }
        
        function editarCliente(id) {
            const cliente = clientes.find(c => c.id === id);
            if (cliente) {
                clienteEditando = id;
                document.getElementById('clienteNome').value = cliente.nome;
                document.getElementById('clienteDoc').value = cliente.documento;
                document.getElementById('clienteEmail').value = cliente.email;
                document.getElementById('clienteTelefone').value = cliente.telefone;
                document.getElementById('clienteEndereco').value = cliente.endereco;
                document.getElementById('clienteObs').value = cliente.obs;
                switchTab('clientes');
            }
        }
        
        function excluirCliente(id) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                clientes = clientes.filter(c => c.id !== id);
                persistState();
                carregarClientes();
                atualizarDashboard();
                alert('‚úì Cliente exclu√≠do com sucesso!');
            }
        }
        
        function verHistoricoCliente(id) {
            const cliente = clientes.find(c => c.id === id);
            const cotacoesCliente = getCotacoesVisiveis().filter(c => c.clienteId === id);
            
            let mensagem = `HIST√ìRICO DO CLIENTE: ${cliente.nome}\n\n`;
            mensagem += `Total de Cota√ß√µes: ${cotacoesCliente.length}\n`;
            mensagem += `Total Movimentado: R$ ${calcularTotalMovimentado(id, cotacoesCliente).toFixed(2)}\n\n`;
            
            if (cotacoesCliente.length > 0) {
                mensagem += 'COTA√á√ïES:\n';
                cotacoesCliente.forEach(cot => {
                    const statusLabel = cot.status === 'fechada' ? 'Fechada' : 
                                       cot.status === 'analise' ? 'Em An√°lise' : 'Aguardando';
                    mensagem += `\n${cot.data} - ${cot.servicoNome}\n`;
                    mensagem += `Valor: R$ ${cot.valorVenda.toFixed(2)} - Status: ${statusLabel}\n`;
                });
            }
            
            alert(mensagem);
        }
        
        function limparFormCliente() {
            document.getElementById('clienteNome').value = '';
            document.getElementById('clienteDoc').value = '';
            document.getElementById('clienteEmail').value = '';
            document.getElementById('clienteTelefone').value = '';
            document.getElementById('clienteEndereco').value = '';
            document.getElementById('clienteObs').value = '';
            clienteEditando = null;
        }
        
        // Comerciais
        function carregarComerciais() {
            const tabela = document.getElementById('tabelaComerciais');
            
            if (comerciais.length === 0) {
                tabela.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhum comercial cadastrado</td></tr>';
            } else {
                tabela.innerHTML = '';
                comerciais.forEach(comercial => {
                    const permissoes = normalizarPermissoes(comercial.permissoes);
                    const permissaoBadges = Object.entries(PERMISSOES_LABELS)
                        .filter(([key]) => permissoes[key])
                        .map(([, label]) => `<span class="badge badge-info">${label}</span>`)
                        .join(' ');
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><strong>${comercial.nome}</strong></td>
                        <td>${comercial.cpf}</td>
                        <td>${comercial.pix}</td>
                        <td>${permissaoBadges || '<span class="badge badge-warning">Sem acesso</span>'}</td>
                        <td><span class="badge badge-${comercial.status === 'ativo' ? 'success' : 'warning'}">${comercial.status.toUpperCase()}</span></td>
                        <td>${comercial.dataCadastro}</td>
                        <td>
                            <button class="action-btn action-btn-edit" onclick="editarComercial(${comercial.id})">‚úèÔ∏è Editar</button>
                            <button class="action-btn action-btn-delete" onclick="excluirComercial(${comercial.id})">üóëÔ∏è Excluir</button>
                        </td>
                    `;
                    tabela.appendChild(tr);
                });
            }
        }
        
        function salvarComercial() {
            const nome = document.getElementById('comercialNome').value;
            const cpf = document.getElementById('comercialCPF').value;
            const pix = document.getElementById('comercialPix').value;
            const status = document.getElementById('comercialStatus').value;
            const doc = document.getElementById('comercialDoc').files[0];
            const selfie = document.getElementById('comercialSelfie').files[0];
            const senha = document.getElementById('comercialSenha').value;
            const permissoes = getPermissoesFromForm();
            
            if (!nome || !cpf || !pix) {
                alert('Por favor, preencha todos os campos obrigat√≥rios!');
                return;
            }
            
            const hoje = new Date().toLocaleDateString('pt-BR');
            
            if (comercialEditando) {
                const comercial = comerciais.find(c => c.id === comercialEditando);
                if (comercial) {
                    comercial.nome = nome;
                    comercial.cpf = cpf;
                    comercial.pix = pix;
                    comercial.status = status;
                    comercial.permissoes = permissoes;
                    if (senha) {
                        comercial.senha = senha;
                    }
                    if (!comercial.documentos) {
                        comercial.documentos = { doc: '', selfie: '' };
                    }
                    if (doc) {
                        comercial.documentos.doc = doc.name;
                    }
                    if (selfie) {
                        comercial.documentos.selfie = selfie.name;
                    }
                }
                comercialEditando = null;
            } else {
                if (!doc || !selfie || !senha) {
                    alert('Para cadastrar um novo comercial, anexos e senha s√£o obrigat√≥rios.');
                    return;
                }
                const novoId = comerciais.length > 0 ? Math.max(...comerciais.map(c => c.id)) + 1 : 1;
                comerciais.push({
                    id: novoId,
                    nome,
                    cpf,
                    pix,
                    status,
                    senha,
                    permissoes,
                    dataCadastro: hoje,
                    documentos: { doc: doc.name, selfie: selfie.name }
                });
            }
            
            persistState();
            carregarComerciais();
            limparFormComercial();
            alert('‚úì Comercial salvo com sucesso!');
        }
        
        function editarComercial(id) {
            const comercial = comerciais.find(c => c.id === id);
            if (comercial) {
                comercialEditando = id;
                document.getElementById('comercialNome').value = comercial.nome;
                document.getElementById('comercialCPF').value = comercial.cpf;
                document.getElementById('comercialPix').value = comercial.pix;
                document.getElementById('comercialStatus').value = comercial.status;
                document.getElementById('comercialDoc').value = '';
                document.getElementById('comercialSelfie').value = '';
                document.getElementById('previewDoc').style.display = 'none';
                document.getElementById('previewSelfie').style.display = 'none';
                document.getElementById('comercialSenha').value = '';
                preencherPermissoesForm(comercial.permissoes);
                switchTab('comerciais');
            }
        }
        
        function excluirComercial(id) {
            if (confirm('Tem certeza que deseja excluir este comercial?')) {
                comerciais = comerciais.filter(c => c.id !== id);
                persistState();
                carregarComerciais();
                alert('‚úì Comercial exclu√≠do com sucesso!');
            }
        }
        
        function limparFormComercial() {
            document.getElementById('comercialNome').value = '';
            document.getElementById('comercialCPF').value = '';
            document.getElementById('comercialPix').value = '';
            document.getElementById('comercialStatus').value = 'ativo';
            document.getElementById('comercialDoc').value = '';
            document.getElementById('comercialSelfie').value = '';
            document.getElementById('previewDoc').style.display = 'none';
            document.getElementById('previewSelfie').style.display = 'none';
            document.getElementById('comercialSenha').value = '';
            definirPermissoesPadraoForm();
            comercialEditando = null;
        }
        
        function previewImage(input, previewId) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById(previewId);
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        // Cota√ß√µes
        function calcularCotacao() {
            const servicoId = parseInt(document.getElementById('cotacaoServico').value);
            const valorVenda = parseFloat(document.getElementById('valorVenda').value) || 0;
            const comissaoPercent = parseFloat(document.getElementById('comissao').value) || 0;
            
            if (!servicoId) {
                document.getElementById('custoDisplay').value = 'Selecione um servi√ßo';
                return;
            }
            
            const servico = servicos.find(s => s.id === servicoId);
            if (!servico) return;
            
            let custoReal = 0;
            let custoDisplay = '';
            
            if (servico.tipoCusto === 'percentual') {
                custoReal = valorVenda * (servico.custo / 100);
                custoDisplay = `${servico.custo}% de R$ ${valorVenda.toFixed(2)} = R$ ${custoReal.toFixed(2)}`;
            } else {
                custoReal = servico.custo;
                custoDisplay = `R$ ${custoReal.toFixed(2)}`;
            }
            
            document.getElementById('custoDisplay').value = custoDisplay;
            
            const margem = valorVenda - custoReal;
            const margemPercent = valorVenda > 0 ? (margem / valorVenda * 100) : 0;
            const comissao = valorVenda * (comissaoPercent / 100);
            
            document.getElementById('resultCusto').textContent = 'R$ ' + custoReal.toFixed(2);
            document.getElementById('resultVenda').textContent = 'R$ ' + valorVenda.toFixed(2);
            document.getElementById('resultMargem').textContent = 'R$ ' + margem.toFixed(2);
            document.getElementById('resultComissaoPercent').textContent = comissaoPercent.toFixed(1) + '%';
            document.getElementById('resultComissao').textContent = 'R$ ' + comissao.toFixed(2);
            document.getElementById('resultFinal').textContent = 'R$ ' + valorVenda.toFixed(2);
        }
        
        function salvarCotacao(status) {
            const clienteId = parseInt(document.getElementById('cotacaoCliente').value);
            const servicoId = parseInt(document.getElementById('cotacaoServico').value);
            const valorVenda = parseFloat(document.getElementById('valorVenda').value) || 0;
            const comissaoPercent = parseFloat(document.getElementById('comissao').value) || 0;
            const observacoes = document.getElementById('observacoes').value;
            
            if (!clienteId || !servicoId || !valorVenda) {
                alert('Por favor, preencha todos os campos obrigat√≥rios!');
                return;
            }
            
            const cliente = clientes.find(c => c.id === clienteId);
            const servico = servicos.find(s => s.id === servicoId);
            
            let custoReal = 0;
            if (servico.tipoCusto === 'percentual') {
                custoReal = valorVenda * (servico.custo / 100);
            } else {
                custoReal = servico.custo;
            }
            
            const margem = valorVenda - custoReal;
            const comissao = valorVenda * (comissaoPercent / 100);
            const hoje = new Date().toLocaleDateString('pt-BR');
            const novoId = cotacoes.length > 0 ? Math.max(...cotacoes.map(c => c.id)) + 1 : 1;
            const comercialId = getComercialIdAtual();
            
            cotacoes.push({
                id: novoId,
                clienteId,
                clienteNome: cliente.nome,
                servicoId,
                servicoNome: servico.nome,
                custo: custoReal,
                valorVenda,
                margem,
                comissaoPercent,
                comissao,
                observacoes,
                status,
                data: hoje,
                comercialId
            });
            
            persistState();
            carregarCotacoes();
            limparFormCotacao();
            atualizarDashboard();
            
            const statusMsg = status === 'fechada' ? 'fechada' : 
                            status === 'analise' ? 'marcada como Em An√°lise' : 
                            'marcada como Aguardando Confirma√ß√£o';
            alert(`‚úì Cota√ß√£o ${statusMsg} com sucesso!`);
        }
        
        function limparFormCotacao() {
            document.getElementById('cotacaoCliente').value = '';
            document.getElementById('cotacaoServico').value = '';
            document.getElementById('custoDisplay').value = '';
            document.getElementById('valorVenda').value = '';
            document.getElementById('comissao').value = '';
            document.getElementById('observacoes').value = '';
            calcularCotacao();
        }
        
        function carregarCotacoes() {
            carregarCotacoesAbertas();
            carregarCotacoesFechadas();
        }
        
        function carregarCotacoesAbertas() {
            const tabela = document.getElementById('tabelaCotacoesAbertas');
            const abertas = getCotacoesVisiveis().filter(c => c.status === 'analise' || c.status === 'aguardando');
            
            if (abertas.length === 0) {
                tabela.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhuma cota√ß√£o em aberto</td></tr>';
            } else {
                tabela.innerHTML = '';
                abertas.forEach(cot => {
                    const tr = document.createElement('tr');
                    const statusLabel = cot.status === 'analise' ? 'Em An√°lise' : 'Aguardando Confirma√ß√£o';
                    const badgeClass = cot.status === 'analise' ? 'badge-warning' : 'badge-info';
                    
                    tr.innerHTML = `
                        <td>${cot.data}</td>
                        <td><strong>${cot.clienteNome}</strong></td>
                        <td>${cot.servicoNome}</td>
                        <td style="color: var(--accent-gold); font-weight: 700;">R$ ${cot.valorVenda.toFixed(2)}</td>
                        <td><span class="badge ${badgeClass}">${statusLabel}</span></td>
                        <td>
                            <button class="action-btn action-btn-edit" onclick="mudarStatusCotacao(${cot.id}, 'fechada')">‚úì Fechar</button>
                            <button class="action-btn action-btn-delete" onclick="excluirCotacao(${cot.id})">üóëÔ∏è Excluir</button>
                        </td>
                    `;
                    tabela.appendChild(tr);
                });
            }
        }
        
        function carregarCotacoesFechadas() {
            const tabela = document.getElementById('tabelaCotacoesFechadas');
            const fechadas = getCotacoesVisiveis().filter(c => c.status === 'fechada');
            
            if (fechadas.length === 0) {
                tabela.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhuma cota√ß√£o fechada</td></tr>';
            } else {
                tabela.innerHTML = '';
                fechadas.forEach(cot => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${cot.data}</td>
                        <td><strong>${cot.clienteNome}</strong></td>
                        <td>${cot.servicoNome}</td>
                        <td style="color: var(--accent-gold); font-weight: 700;">R$ ${cot.valorVenda.toFixed(2)}</td>
                        <td style="color: var(--success); font-weight: 700;">R$ ${cot.comissao.toFixed(2)}</td>
                        <td>
                            <button class="action-btn action-btn-delete" onclick="excluirCotacao(${cot.id})">üóëÔ∏è Excluir</button>
                        </td>
                    `;
                    tabela.appendChild(tr);
                });
            }
        }
        
        function mudarStatusCotacao(id, novoStatus) {
            const cotacao = cotacoes.find(c => c.id === id);
            if (cotacao) {
                if (!podeGerenciarCotacao(cotacao)) {
                    alert('Voc√™ n√£o pode alterar esta cota√ß√£o.');
                    return;
                }
                cotacao.status = novoStatus;
                persistState();
                carregarCotacoes();
                atualizarDashboard();
                alert('‚úì Status da cota√ß√£o atualizado!');
            }
        }
        
        function excluirCotacao(id) {
            if (confirm('Tem certeza que deseja excluir esta cota√ß√£o?')) {
                const cotacao = cotacoes.find(c => c.id === id);
                if (cotacao && !podeGerenciarCotacao(cotacao)) {
                    alert('Voc√™ n√£o pode excluir esta cota√ß√£o.');
                    return;
                }
                cotacoes = cotacoes.filter(c => c.id !== id);
                persistState();
                carregarCotacoes();
                atualizarDashboard();
                alert('‚úì Cota√ß√£o exclu√≠da com sucesso!');
            }
        }
        
        function filtrarCotacoesAbertas() {
            const busca = document.getElementById('filtroAbertoBusca').value.toLowerCase();
            const status = document.getElementById('filtroAbertoStatus').value;
            
            let abertas = getCotacoesVisiveis().filter(c => c.status === 'analise' || c.status === 'aguardando');
            
            if (busca) {
                abertas = abertas.filter(c => c.clienteNome.toLowerCase().includes(busca));
            }
            
            if (status) {
                abertas = abertas.filter(c => c.status === status);
            }
            
            const tabela = document.getElementById('tabelaCotacoesAbertas');
            
            if (abertas.length === 0) {
                tabela.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhuma cota√ß√£o encontrada</td></tr>';
            } else {
                tabela.innerHTML = '';
                abertas.forEach(cot => {
                    const tr = document.createElement('tr');
                    const statusLabel = cot.status === 'analise' ? 'Em An√°lise' : 'Aguardando Confirma√ß√£o';
                    const badgeClass = cot.status === 'analise' ? 'badge-warning' : 'badge-info';
                    
                    tr.innerHTML = `
                        <td>${cot.data}</td>
                        <td><strong>${cot.clienteNome}</strong></td>
                        <td>${cot.servicoNome}</td>
                        <td style="color: var(--accent-gold); font-weight: 700;">R$ ${cot.valorVenda.toFixed(2)}</td>
                        <td><span class="badge ${badgeClass}">${statusLabel}</span></td>
                        <td>
                            <button class="action-btn action-btn-edit" onclick="mudarStatusCotacao(${cot.id}, 'fechada')">‚úì Fechar</button>
                            <button class="action-btn action-btn-delete" onclick="excluirCotacao(${cot.id})">üóëÔ∏è Excluir</button>
                        </td>
                    `;
                    tabela.appendChild(tr);
                });
            }
        }
        
        function filtrarCotacoesFechadas() {
            const busca = document.getElementById('filtroFechadoBusca').value.toLowerCase();
            
            let fechadas = getCotacoesVisiveis().filter(c => c.status === 'fechada');
            
            if (busca) {
                fechadas = fechadas.filter(c => c.clienteNome.toLowerCase().includes(busca));
            }
            
            const tabela = document.getElementById('tabelaCotacoesFechadas');
            
            if (fechadas.length === 0) {
                tabela.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhuma cota√ß√£o encontrada</td></tr>';
            } else {
                tabela.innerHTML = '';
                fechadas.forEach(cot => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${cot.data}</td>
                        <td><strong>${cot.clienteNome}</strong></td>
                        <td>${cot.servicoNome}</td>
                        <td style="color: var(--accent-gold); font-weight: 700;">R$ ${cot.valorVenda.toFixed(2)}</td>
                        <td style="color: var(--success); font-weight: 700;">R$ ${cot.comissao.toFixed(2)}</td>
                        <td>
                            <button class="action-btn action-btn-delete" onclick="excluirCotacao(${cot.id})">üóëÔ∏è Excluir</button>
                        </td>
                    `;
                    tabela.appendChild(tr);
                });
            }
        }
        
        // Dashboard
        function atualizarDashboard() {
            const base = getCotacoesVisiveis();
            const abertas = base.filter(c => c.status === 'analise' || c.status === 'aguardando').length;
            const fechadas = base.filter(c => c.status === 'fechada').length;
            const valorTotal = base
                .filter(c => c.status === 'fechada')
                .reduce((total, c) => total + c.valorVenda, 0);
            const clientesSet = new Set(base.map(c => c.clienteId));
            const totalClientesIndicador = isAdminUser() ? clientes.length : clientesSet.size;
            
            document.getElementById('totalAberto').textContent = abertas;
            document.getElementById('totalFechado').textContent = fechadas;
            document.getElementById('valorTotal').textContent = 'R$ ' + valorTotal.toFixed(2);
            document.getElementById('totalClientes').textContent = totalClientesIndicador;
        }
        
        // Formata√ß√£o de CPF
        document.getElementById('comercialCPF').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            
            if (value.length > 9) {
                value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            } else if (value.length > 6) {
                value = value.replace(/(\d{3})(\d{3})(\d{1,3})/, '$1.$2.$3');
            } else if (value.length > 3) {
                value = value.replace(/(\d{3})(\d{1,3})/, '$1.$2');
            }
            
            e.target.value = value;
        });
    </script>
</body>
</html>
